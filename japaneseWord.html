<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

		<style>
		.buttonBox{
			width: 100%;
		}

		.buttonJp {
		  padding: 5px 0px;
		  text-align: center;
		  text-decoration: none;
		  display: inline-block;
		  font-size: 16px;
	  	border: thick solid white;
			width: 100%;
			font-weight: bold;
			overflow: hidden;
			height: 60px;
		}

		.showText{
			border: thick solid grey;
			background-color: white;
			text-align: center;
		}

		.next{
			background-color: #555555;
	  	color: white;
		}

		.buttonJp.active {
		  background-color: #666;
		  color: white;
		}

		.btnFilter{
			width: 100%;
			text-overflow: ellipsis;
	  	overflow: hidden;
			padding: 2px 0px;
			height: 35px;
		}
		</style>

		<style>
		#source {
		  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
		  border-collapse: collapse;
		  font-size: 16px;
		  width: 100%;
		}

		#source td, #source th {
		  border: 1px solid #ddd;
		}

		#source tr:nth-child(even){background-color: #f2f2f2;}

		#source tr:hover {background-color: #ddd;}

		#source th {
		  padding-top: 12px;
		  padding-bottom: 12px;
		  text-align: left;
		  background-color: #949494;
		  color: white;
		}
		</style>
</head>

<title>Dadiu | 日語常用詞庫 - 測驗</title>

<body onload="restart();">
	<div id="head">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">首頁</a>
	</div>

	<!-- The Modal -->
	<link rel="stylesheet" href="/css/modal_box_style.css">
	<div id="myModal" class="modal">
	  <div class="modal-content">
	    <span id="close" class="close">&times;</span>
			<a id="toppest" class="smooth"></a>
			<table id="source">
			</table>
	  </div>
	</div>

	<div id="buttonBox">
		<button id="btnOpenModal" class="buttonJp btnFilter">內容</button>
		<button id="btnFilterShow" class="buttonJp btnFilter active" onclick="openNav()">過濾</button>
		<button id="btnTraslateWay" class="buttonJp btnFilter" onclick="changeWayUI()">日語 => 中文</button>
	</div>

	<p class="showText" style="font-size:8vw;" id="textJapan"></p>

	<div class="buttonBox">
			<button id="mc0" class="buttonJp" type="button" onclick="showResult(0)"></button>
			<button id="mc1" class="buttonJp" type="button" onclick="showResult(1)"></button>
			<br>
			<button id="mc2" class="buttonJp" type="button" onclick="showResult(2)"></button>
			<button id="mc3" class="buttonJp" type="button" onclick="showResult(3)"></button>
	</div>
	<p><button id="next" class="buttonJp next" type="button" onclick="restart()">下一個</button></p>
	<h4 style="text-align: center;" id="result"></h4>

	<script>

		var dir = {};
		var arrJp = {};
		var arrEn = {};
		var total = 0;
		var filterSelected = "Number";
		var changeWay = 0;

		var index = parseInt(Math.random() * (total - 1) + 1, 10);
		var showText = "";
		var correct = 0;
		var ttlAns = 0;
		var mc = {};
		var answered = true;

		function changeWayUI(){
			var btn = document.getElementById("btnTraslateWay");
			if(changeWay == 0){
				changeWay = 1;
				btn.className += " active";
				btn.innerHTML = "中文 => 日語";
			}else{
				changeWay = 0
				btn.className = btn.className.replace(" active", "");
				btn.innerHTML = "日語 => 中文";
			}
			restart();
		}

		function loadDoc(type)
		{
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function(){
				  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
							dir = [];
							document.getElementById("source").innerHTML = '<tr><th>日語</th><th>來源</th><th>中文</th><th>英語</th><th>詞性</th></tr>';

				    	var txt = xmlhttp.responseText;

							var arr = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
						  arrJp = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							var arrZh = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							arrEn = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							arr.shift();
							arrJp.shift();
							arrZh.shift();
							arrEn.shift();

							for(i = 0; i < arr.length; i++){
								arrJp[i] = arr[i].substr(0, arrJp[i].indexOf('</span>'));
								dir[i] = '<tr>';
								dir[i] += '<td>' + arrJp[i] + '</td>';

								var jpText = arr[i].split('<span class="txt-ja txt-ls1 kanji">');
								var jpValue = '';
								if(jpText.length == 2){
									jpValue = jpText[1].substr(0, jpText[1].indexOf('</span>'))
									.replace(' ','')
									.replace(/・/g, ' / ')
									.replace('【', '')
									.replace('】', '');
								}
								dir[i] += '<td>' + jpValue + '</td>';

								var zhText = arr[i].split('<p class="txt-zh zh">');
								var zhValue = '';
								if(zhText.length == 2){
									zhValue = zhText[1].substr(0, zhText[1].indexOf('</p>'))
									.replace(/・/g, ' / ');
								}else{
									zhValue = '';
								}
								arrZh[i] = zhValue;
								dir[i] += '<td>' + zhValue + '</td>';

								var enText = arr[i].split('<p class="txt-zh en">');
								var enValue = '';
								if(enText.length == 2){
									enValue = enText[1].substr(0, enText[1].indexOf('</p>'))
									.replace('(英) ','')
									.replace(/・/g, ' / ');
								}
								dir[i] += '<td>' + enValue + '</td>';

								var typeText = arr[i].split('<span class="wordClass" style="">');
								var typeValue = '';
								if(typeText.length == 2){
									typeValue = typeText[1].substr(0, typeText[1].indexOf('</span>'))
									.replace(' ','')
									.replace(/・/g, ' / ')
									.replace('《', '')
									.replace('》', '');
								}
								dir[i] += '<td>' + typeValue + '</td>';

								dir[i] += '</tr>';
								document.getElementById("source").innerHTML += dir[i];
								arrEn[i] = arrZh[i];
							}

							if(changeWay){
									var arrTemp = {};
									for(i = 0; i < arrJp.length; i++){
										arrTemp[i] = arrJp[i];
									}
									for(i = 0; i < arrJp.length; i++){
										arrJp[i] = arrEn[i];
									}
									for(i = 0; i < arrJp.length; i++){
										arrEn[i] = arrTemp[i];
									}
							}
							total = arr.length;
							genShowJpText();
							genMC();
				  }
				};
				xmlhttp.open("GET","./txt/" + type + "Html.txt",true);
				xmlhttp.send();
		}

		function filterSelection(text){
			var element = document.getElementById("btnFilter" + text);
			filterSelected = text;
			loadDoc(text);
			closeNav();
			document.getElementById("btnFilterShow").innerHTML = element.innerHTML + " [過濾]";
			document.getElementById("btnOpenModal").innerHTML = element.innerHTML + " [內容]";
			clear();
		}

		function restart(){
			filterSelection(filterSelected);
			clear();
		}

		function clear(){
			answered = false;
			for(var i = 0; i < mc.length; i ++){
					document.getElementById("mc" + i).style.borderColor  = "#ffffff";
			}
		}

		function genShowJpText(){
			index = parseInt(Math.random() * (total - 0) + 0, 10);
			showText = arrJp[index];
			document.getElementById("textJapan").innerHTML = showText;
		}

		function genMC(){
			mc = getRandom(arrEn, 4);
			shuffle(mc);

			for(var i = 0; i < mc.length; i++){
				document.getElementById("mc" + i).innerHTML = mc[i];
			}
		}

		function showResult(mcChoose){
			if(!answered){
				var mcIndex = mc.indexOf(arrEn[index]);
				if(mcIndex != mcChoose){
					document.getElementById("mc" + mcChoose).style.borderColor  = "#FF0000";
				}else{
					correct++;
				}
				document.getElementById("mc" + mcIndex).style.borderColor  = "#4CAF50";
				answered = true;
				ttlAns++;
				document.getElementById("result").innerHTML  = correct + " / " + ttlAns;
			}
		}

		//copy from google start
		function getRandom(arr, n) {
				var result = new Array(n),
						len = arr.length,
						taken = new Array(len);
				if (n > len)
						throw new RangeError("getRandom: more elements taken than available");
				while (n--) {
						var x = Math.floor(Math.random() * len);
						if(!(arrEn[x] == arrEn[index] && x != index)){
							result[n] = arr[x in taken ? taken[x] : x];
							taken[x] = --len in taken ? taken[len] : len;
						}else{
								n++;
						}
						//console.log("n: " + n + "; x: " + x + "; taken: " + taken + "; result: " + result + "; value: " + arrJp[x] + "..." + arrEn[x]);
				}
				if(!result.includes(arrEn[index])){
					result[0] = arrEn[index];
				}
				return result;
		}

		function shuffle(array) {
			var currentIndex = array.length, temporaryValue, randomIndex;
			while (0 !== currentIndex) {
				randomIndex = Math.floor(Math.random() * currentIndex);
				currentIndex -= 1;
				temporaryValue = array[currentIndex];
				array[currentIndex] = array[randomIndex];
				array[randomIndex] = temporaryValue;
			}
			return array;
		}
		//copy from google end

		//open source start
		// Get the modal
		var modal = document.getElementById('myModal');
		// Get the button that opens the modal
		var btnOpenModal = document.getElementById("btnOpenModal");
		// Get the <span> element that closes the modal
		var close = document.getElementById("close");
		// When the user clicks on the button, open the modal
		btnOpenModal.onclick = function() {
		    modal.style.display = "block";
				btnOpenModal.className += " active";
		}
		// When the user clicks on <span> (x), close the modal
		close.onclick = function() {
		    modal.style.display = "none";
				btnOpenModal.className = btnOpenModal.className.replace(" active", "");
		}
		// When the user clicks anywhere outside of the modal, close it

		function closeSourcePage(event){
		    if (event.target == modal) {
		        modal.style.display = "none";
						btnOpenModal.className = btnOpenModal.className.replace(" active", "");
		    }else if(event.target != document.getElementById("btnFilterShow")
						&& event.target != document.getElementById("btnFilterNumber")
						&& event.target != document.getElementById("btnFilterTraditionalQty")
						&& event.target != document.getElementById("btnFilterWeek")
						&& event.target != document.getElementById("btnFilterTiming")
						&& event.target != document.getElementById("btnFilterTime")
						&& event.target != document.getElementById("btnFilterMonth")
						&& event.target != document.getElementById("btnFilterDay")
						&& event.target != document.getElementById("btnFilterPplNum")
						&& event.target != document.getElementById("btnFilterDirection")
						&& event.target != document.getElementById("btnFilterSeasonWeather")
						&& event.target != document.getElementById("btnFilterNewStandard1")
						&& event.target != document.getElementById("btnFilterNewStandard2")
						&& event.target != document.getElementById("btnFilterNewStandard3")
						&& event.target != document.getElementById("btnFilterNewStandard4")
						&& event.target != document.getElementById("btnFilterNewStandard5")
						&& event.target != document.getElementById("btnFilterNewStandard6")
						&& event.target != document.getElementById("btnFilterNewStandard7")
						&& event.target != document.getElementById("btnFilterEveryone1")
						&& event.target != document.getElementById("btnFilterEveryone2")
						&& event.target != document.getElementById("btnFilterEveryone3")
						&& event.target != document.getElementById("btnFilterEveryone4")
						&& event.target != document.getElementById("btnFilterEveryone5")
						&& event.target != document.getElementById("btnFilterEveryone6")
						&& event.target != document.getElementById("mySidenav")
						&& document.getElementById("mySidenav").style.width != "0px"
					){
						closeNav();
				}
		}

		window.onclick = function(event) {
		    closeSourcePage(event);
		}

		window.addEventListener('touchstart', function (event) {
		    closeSourcePage(event);
		});
		//open source end
	</script>

	<link rel="stylesheet" href="/css/side_bar_style.css">
	<div id="nav_subtitle">
		<div id="mySidenav" class="sidenav">
				<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		 		<a href="#" id="btnFilterNumber" onclick="filterSelection('Number')">數字</a>
		 		<a href="#" id="btnFilterTraditionalQty" onclick="filterSelection('TraditionalQty')">傳統數量詞</a>
		 		<a href="#" id="btnFilterWeek" onclick="filterSelection('Week')">星期</a>
		 		<a href="#" id="btnFilterTiming" onclick="filterSelection('Timing')">時候</a>
		 		<a href="#" id="btnFilterTime" onclick="filterSelection('Time')">時間</a>
		 		<a href="#" id="btnFilterMonth" onclick="filterSelection('Month')">日期(月)</a>
		 		<a href="#" id="btnFilterDay" onclick="filterSelection('Day')">日期(日)</a>
		 		<a href="#" id="btnFilterPplNum" onclick="filterSelection('PplNum')">人數的計算</a>
		 		<a href="#" id="btnFilterDirection" onclick="filterSelection('Direction')">方向</a>
		 		<a href="#" id="btnFilterSeasonWeather" onclick="filterSelection('SeasonWeather')">季節、天氣</a>
		 		<a href="#" id="btnFilterNewStandard1" onclick="filterSelection('NewStandard1')">新標準日本語(1)</a>
		 		<a href="#" id="btnFilterNewStandard2" onclick="filterSelection('NewStandard2')">新標準日本語(2)</a>
		 		<a href="#" id="btnFilterNewStandard3" onclick="filterSelection('NewStandard3')">新標準日本語(3)</a>
		 		<a href="#" id="btnFilterNewStandard4" onclick="filterSelection('NewStandard4')">新標準日本語(4)</a>
		 		<a href="#" id="btnFilterNewStandard5" onclick="filterSelection('NewStandard5')">新標準日本語(5)</a>
		 		<a href="#" id="btnFilterNewStandard6" onclick="filterSelection('NewStandard6')">新標準日本語(6)</a>
		 		<a href="#" id="btnFilterNewStandard7" onclick="filterSelection('NewStandard7')">新標準日本語(7)</a>
		 		<a href="#" id="btnFilterEveryone1" onclick="filterSelection('Everyone1')">大家的日本語(1)</a>
		 		<a href="#" id="btnFilterEveryone2" onclick="filterSelection('Everyone2')">大家的日本語(2)</a>
		 		<a href="#" id="btnFilterEveryone3" onclick="filterSelection('Everyone3')">大家的日本語(3)</a>
		 		<a href="#" id="btnFilterEveryone4" onclick="filterSelection('Everyone4')">大家的日本語(4)</a>
		 		<a href="#" id="btnFilterEveryone5" onclick="filterSelection('Everyone5')">大家的日本語(5)</a>
		 		<a href="#" id="btnFilterEveryone6" onclick="filterSelection('Everyone6')">大家的日本語(6)</a>
				</br></br></br>
				</br></br></br>
				<!--
		 		<a href="#" id="btnFilterN5Noun" onclick="filterSelection('N5Noun')">N5 名詞</a>
		 		<a href="#" id="btnFilterN5Adj" onclick="filterSelection('N5Adj')">N5 形容詞</a>
		 		<a href="#" id="btnFilterN5Verb" onclick="filterSelection('N5Verb')">N5 動詞</a>
				-->
		</div>
	</div>
	<script>
	function openNav() {
			document.getElementById("mySidenav").style.width = "280px";
	    document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
	}
	function closeNav() {
	    document.getElementById("mySidenav").style.width = "0";
	    document.body.style.backgroundColor = "#fbf7ff";
	}
	</script>

	<link rel="stylesheet" type="text/css" href="/css/to_top_not_immediate.css">
	<div id="head">
		<div id="nav">
			 <ul>
				 <li><a id="myBtn" href="#toppest" class="subtitle" >Top</a></li>
			 </ul>
		</div>
	</div>
	<script>
		var modal = document.getElementById('myModal');
		modal.onscroll = function() {scrollFunction()};

		function scrollFunction() {
			if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {
				document.getElementById("myBtn").style.display = "block";
			} else {
				document.getElementById("myBtn").style.display = "none";
			}
		}
	</script>

	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
