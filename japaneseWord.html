<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

		<style>
		.buttonBox{
			width: 100%;
		}

		.buttonJp {
		  padding: 15px 0px;
		  text-align: center;
		  text-decoration: none;
		  display: inline-block;
		  font-size: 16px;
	  	border: thick solid white;
			width: 49%;
			font-weight: bold;
			overflow: hidden;
		}

		.showText{
			border: thick solid grey;
			background-color: white;
			text-align: center;
		}

		.next{
			background-color: #555555;
	  	color: white;
		}

		.buttonJp.active {
		  background-color: #666;
		  color: white;
		}

		.btnFilter{
			width: 32%;
			text-overflow: ellipsis;
	  	overflow: hidden;
			padding: 2px 0px;
		}
		</style>
</head>

<title>Dadiu | Template</title>

<body onload="restart();">
	<div id="head">
		<a href="/">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
		</a>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">Home</a>
	</div>








	<div id="buttonBox">
		<button id="btnFilterNumber" class="buttonJp btnFilter active" onclick="filterSelection('Number')">Number</button>
		<button id="btnFilterTraditionalQty" class="buttonJp btnFilter" onclick="filterSelection('TraditionalQty')">Traditional Quantity</button>
		<button id="btnFilterWeek" class="buttonJp btnFilter" onclick="filterSelection('Week')">Week</button>
		<button id="btnFilterTiming" class="buttonJp btnFilter" onclick="filterSelection('Timing')">Timing</button>
		<button id="btnFilterTime" class="buttonJp btnFilter" onclick="filterSelection('Time')">Time</button>
		<button id="btnFilterMonth" class="buttonJp btnFilter" onclick="filterSelection('Month')">Month</button>
		<button id="btnFilterDay" class="buttonJp btnFilter" onclick="filterSelection('Day')">Day</button>
		<button id="btnFilterPplNum" class="buttonJp btnFilter" onclick="filterSelection('PplNum')">People Count</button>
		<button id="btnFilterDirection" class="buttonJp btnFilter" onclick="filterSelection('Direction')">Direction</button>
		<button id="btnFilterSeasonWeather" class="buttonJp btnFilter" onclick="filterSelection('SeasonWeather')">Season & Weather</button>
		<button id="btnFilterNewStandard1" class="buttonJp btnFilter" onclick="filterSelection('NewStandard1')">New Standard 1</button>
	</div>

	<p class="showText" style="font-size:10vw;" id="textJapan"></p>

	<div class="buttonBox">
			<button id="mc0" class="buttonJp" type="button" onclick="showResult(0)"></button>
			<button id="mc1" class="buttonJp" type="button" onclick="showResult(1)"></button>
			<br>
			<button id="mc2" class="buttonJp" type="button" onclick="showResult(2)"></button>
			<button id="mc3" class="buttonJp" type="button" onclick="showResult(3)"></button>
	</div>
	<p><button id="next" class="buttonJp next" type="button" onclick="restart()">Next</button></p>
	<h4 style="text-align: center;" id="result"></h4>

	<script>

		var arrJp = {};
		var arrEn = {};
		var total = 0;
		var filterSelected = "Number";

		var index = parseInt(Math.random() * (total - 1) + 1, 10);
		var showText = "";
		var correct = 0;
		var ttlAns = 0;
		var mc = {};
		var answered = true;

		function loadDoc(type)
		{
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function(){
				  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
				    	var txt = xmlhttp.responseText;

							var arr = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
						  arrJp = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							var arrZh = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							arrEn = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							arr.shift();
							arrJp.shift();
							arrZh.shift();
							arrEn.shift();

							for(i = 0; i < arr.length; i++){
								arrJp[i] = arr[i].substr(0, arrJp[i].indexOf('</span>'));

								var zhText = arr[i].split('<p class="txt-zh zh">');
								if(zhText.length == 2){
									arrZh[i] = zhText[1].substr(0, zhText[1].indexOf('</p>'));
								}else{
									arrZh[i] = '';
								}

								var enText = arr[i].split('<p class="txt-zh en">');
								if(enText.length == 2){
									arrEn[i] = enText[1].substr(0, enText[1].indexOf('</p>')).replace('(英) ','');
								}else{
									arrEn[i] = '';
								}

								arrEn[i] = arrZh[i].replace(/・/g, ' / ');
							}

							total = arr.length;
				  }
				};
				xmlhttp.open("GET","./txt/" + type + "Html.txt",true);
				xmlhttp.send();
		}

		function filterSelection(text){
			var element = document.getElementById("btnFilterNumber");
			element.classList.remove("active");
			element = document.getElementById("btnFilterTraditionalQty");
			element.classList.remove("active");
			element = document.getElementById("btnFilterWeek");
			element.classList.remove("active");
			element = document.getElementById("btnFilterTiming");
			element.classList.remove("active");
			element = document.getElementById("btnFilterTime");
			element.classList.remove("active");
			element = document.getElementById("btnFilterMonth");
			element.classList.remove("active");
			element = document.getElementById("btnFilterDay");
			element.classList.remove("active");
			element = document.getElementById("btnFilterPplNum");
			element.classList.remove("active");
			element = document.getElementById("btnFilterDirection");
			element.classList.remove("active");
			element = document.getElementById("btnFilterSeasonWeather");
			element.classList.remove("active");
			element = document.getElementById("btnFilterNewStandard1");
			element.classList.remove("active");

			element = document.getElementById("btnFilter" + text);
			element.classList.add("active");
			filterSelected = text;
			loadDoc(text);
		}

		function restart(){
			filterSelection(filterSelected);
			genShowJpText();
			genMC();
			answered = false;
			for(var i = 0; i < mc.length; i ++){
					document.getElementById("mc" + i).style.borderColor  = "#ffffff";
			}
		}

		function genShowJpText(){
			index = parseInt(Math.random() * (total - 0) + 0, 10);
			showText = arrJp[index];
			document.getElementById("textJapan").innerHTML = showText;
		}

		function genMC(){
			var correctAns = arrEn[index];
			mc = getRandom(arrEn, 4);
			var exist = mc.includes(correctAns);
			if(!exist){
				mc[0] = arrEn[index];
			}
			shuffle(mc);

			for(var i = 0; i < mc.length; i++){
				document.getElementById("mc" + i).innerHTML = mc[i];
			}
		}

		function showResult(mcChoose){
			if(!answered){
				var mcIndex = mc.indexOf(arrEn[index]);
				if(mcIndex != mcChoose){
					document.getElementById("mc" + mcChoose).style.borderColor  = "#FF0000";
				}else{
					correct++;
				}
				document.getElementById("mc" + mcIndex).style.borderColor  = "#4CAF50";
				answered = true;
				ttlAns++;
				document.getElementById("result").innerHTML  = correct + " / " + ttlAns;
			}
		}

		//copy from google start
		function getRandom(arr, n) {
				var result = new Array(n),
						len = arr.length,
						taken = new Array(len);
				if (n > len)
						throw new RangeError("getRandom: more elements taken than available");
				while (n--) {
						var x = Math.floor(Math.random() * len);
						result[n] = arr[x in taken ? taken[x] : x];
						taken[x] = --len in taken ? taken[len] : len;
				}
				return result;
		}

		function shuffle(array) {
			var currentIndex = array.length, temporaryValue, randomIndex;
			while (0 !== currentIndex) {
				randomIndex = Math.floor(Math.random() * currentIndex);
				currentIndex -= 1;
				temporaryValue = array[currentIndex];
				array[currentIndex] = array[randomIndex];
				array[randomIndex] = temporaryValue;
			}
			return array;
		}

		// Add active class to the current button (highlight it)
		var btns = document.getElementsByClassName("btnFilter");
		for (var i = 0; i < btns.length; i++) {
			btns[i].addEventListener("click", function(){
				var current = document.getElementsByClassName("active");
				current[0].className = current[0].className.replace(" active", "");
				this.className += " active";
			});
		}
		//copy from google end
	</script>






	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
