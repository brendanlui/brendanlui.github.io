<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link id="stylecall4" rel="stylesheet" href="/css/japanese.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

</head>

<title>Dadiu | 搜尋 - 大家的日本語</title>

<body onload="document.getElementById('searchKey').focus();">
	<div id="head">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">首頁</a>
	</div>

	<!--TODO-->
	<style>
	.search {
	  width: 100%;
	  position: relative;
	  display: flex;
	}

	.searchTerm {
	  width: 100%;
	  border: 3px solid #c9c9c9;
	  border-right: none;
	  padding: 5px;
	  height: 20px;
	  border-radius: 5px 0 0 5px;
	  outline: none;
	  color: #616161;
	  font-size: 14px;
	}

	.searchTerm:focus{
	  color: #4d4d4d;
	}

	.searchButton {
	  width: 40px;
	  height: 36px;
	  border: 1px solid #c9c9c9;
	  background: #c9c9c9;
	  text-align: center;
	  color: #fff;
	  border-radius: 0 5px 5px 0;
	  cursor: pointer;
	  font-size: 20px;
		margin-top: 5px;
		margin-bottom: 5px;
	}

	/*Resize the wrap to see the search bar change!*/
	.wrap{
	  width: 100%;
	}

	input[type="text"]{
		width: 100%;
	}
	</style>
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

	<style>
	.buttonload {
	  background-color: #cfcfcf; /* Green background */
	  border: none; /* Remove borders */
	  color: white; /* White text */
	  padding: 12px 24px; /* Some padding */
	  font-size: 16px; /* Set a font-size */
	  width: 100%;
		display:none;
	  margin-bottom: 5px;
	}
	</style>

	<div class="wrap">
		<div class="search">
				<input type="text" class="searchTerm" id="searchKey" name="search"/>
				<button type="submit" class="searchButton" id="searchClick" onclick="searchAll()"><i class="fa fa-search"></i></button>
		</div>
	</div>
	<button id="myBar" class="buttonload">
		<i class="fa fa-refresh fa-spin"></i> Loading
	</button>

	<div id="myModal" class="modal">
	  <div class="modal-content">
			<a id="toppest" class="smooth"></a>
			<table id="source">
			</table>
			<span style="display:none;" id="displayNone"></sapn>
	  </div>
	</div>

	<link rel="stylesheet" href="/css/modal_box_style2.css">
	<div id="myModal2" class="modal2">
	  <div class="modal-content2">
	    <span id="close2" class="close2">&times;</span>
			<table id="source2">
			</table>
			</br>
			<table id="source3">
			</table>
	  </div>
	</div>

	<script>
			var input = document.getElementById("searchKey");
			// Execute a function when the user releases a key on the keyboard
			input.addEventListener("keyup", function(event) {
				// Number 13 is the "Enter" key on the keyboard
				if (event.keyCode === 13) {
				// Cancel the default action, if needed
				event.preventDefault();
				// Trigger the button element with a click
				document.getElementById("searchClick").click();
				}
			});


			var existSearchKey = "";
			var responseTotal = 0;
			var resultSet = {};
			function searchAll(){
				var searchKey = document.getElementById("searchKey").value.trim();
				if(searchKey != existSearchKey){
						document.getElementById("displayNone").innerHTML = "";
						document.getElementById("source").innerHTML = '<tr>'
									+ '<th>單元</th>'
									+	'<th>日語</th>'
									+ '<th>重音</th>'
									+ '<th>漢字</th>'
									+ '<th>解釋</th>'
									//+ '<th>英語</th>'
									+ '<th>詞性</th>'
									+ '</tr>';

						if(searchKey != ""){
							document.getElementById("myBar").style.display = "block";
							existSearchKey = searchKey;
							for(i = 1; i <= 50; i++){
								searchEach('Old' + i, searchKey);
							}
						}
				}
			}

			function searchEach(type, searchKey)
			{
					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
					  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
								var string = [];
					    	var txt = xmlhttp.responseText;

								var arr = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							  var arrJp = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							  var arrJpS = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrZh = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrEn = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrSen = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrSenExpl = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								arr.shift();
								arrJp.shift();
								arrJpS.shift();
								arrZh.shift();
								arrEn.shift();
								arrSen.shift();
								arrSenExpl.shift();

								for(i = 0; i < arr.length; i++){
									//Save Sentence start
									arrSen[i] = "";
									arrSenExpl[i] = "";
									var arrSenTemp_i = arr[i].split('<span class="furigana">');
									var arrSenExplTemp_i = arr[i].split('<p lang="ja" class="txt-zh zh">');
									if(arrSenTemp_i.length >= 2 && arrSenExplTemp_i.length >= 2){
										var arrSenTemp_j = arrSenTemp_i[1].split('</span>');
										var arrSenExplTemp_j = arrSenExplTemp_i[1].split('</p>');
										if(arrSenTemp_j.length >= 2 && arrSenExplTemp_j.length >= 2){
												arrSen[i] = arrSenTemp_j[0];
												arrSenExpl[i] = arrSenExplTemp_j[0];
										}
									}
									//Save Sentence end

									arrJp[i] = arr[i].substr(0, arrJp[i].indexOf('</span>')).trim();
									string[i] = type.replace("Old", "") + ";";
									string[i] += '<a onclick="btnOpenModal2('+arrSen[i]+ ', ' + arrSenExpl[i] + ')">' + arrJp[i] + "</a>;";

									var accentText = arr[i].split('<span class="txt-ja toneNum">');
									var accentValue = '';
									if(accentText.length == 2){
										accentValue = accentText[1].substr(0, accentText[1].indexOf('</span> </span>'))
										.trim()
										.replace('</span> <span>','][')
										.replace('<span>','')
										.replace('⓪','0')
										.replace('①','1')
										.replace('②','2')
										.replace('③','3')
										.replace('④','4')
										.replace('⑤','5')
										.replace('⑥','6')
										.replace('⑦','7')
										.replace('⑧','8')
										.replace('⑨','9')
										.replace('⑩','10');
									}
									if(accentValue != ''){
										string[i] += '[' + accentValue + ']';
										arrJp[i] += '<span class="accentJpValue">[' + accentValue + ']</span>';
									}
									string[i] += ";";

									var jpText = arr[i].split('<span class="txt-ja txt-ls1 kanji">');
									var jpValue = '';
									if(jpText.length == 2){
										jpValue = jpText[1].substr(0, jpText[1].indexOf('</span>'))
										.trim()
										.replace(/・/g, ' / ')
										.replace('【', '')
										.replace('】', '');
									}
									arrJpS[i] = jpValue;
									string[i] += jpValue + ";";

									var zhText = arr[i].split('<p class="txt-zh zh">');
									var zhValue = '';
									if(zhText.length == 2){
										zhValue = zhText[1].substr(0, zhText[1].indexOf('</p>'))
										.replace(/・/g, ' / ');
									}else{
										zhValue = '';
									}
									arrZh[i] = zhValue;
									string[i] += zhValue + ";";

									/*
									var enText = arr[i].split('<p class="txt-zh en">');
									var enValue = '';
									if(enText.length == 2){
										enValue = enText[1].substr(0, enText[1].indexOf('</p>'))
										.replace('(英) ','')
										.replace(/・/g, ' / ');
									}
									dir[i] += '<td>' + enValue + '</td>';
									*/

									var typeText = arr[i].split('<span class="wordClass" style="">');
									var typeValue = '';
									if(typeText.length == 2){
										typeValue = typeText[1].substr(0, typeText[1].indexOf('</span>'))
										.trim()
										.replace(/・/g, ' / ')
										.replace('《', '')
										.replace('》', '');
									}
									string[i] += typeValue + ";";

									string[i] += arrSen[i] + ";";
									string[i] += arrSenExpl[i] + ";";

									if(arrZh[i].includes("<")){
										arrZh[i] = arrZh[i].split("<")[0];
									}
									if(arrJp[i].includes("<")){
										arrJp[i] = arrJp[i].split("<")[0];
									}
									if(arrJpS[i].includes("<")){
										arrJpS[i] = arrJpS[i].split("<")[0];
									}
									if(arrZh[i].includes(searchKey) || arrJp[i].includes(searchKey) || arrJpS[i].includes(searchKey)){
											document.getElementById("displayNone").innerHTML += string[i] + "^.^";
									}
								}
								responseTotal++;
								var elem = document.getElementById("myBar");
								if(responseTotal == 50){
									elem.style.display = "none";
									responseTotal = 0;
									resultSet = document.getElementById("displayNone").innerHTML.split("^.^");
									resultSet.sort(function(a, b){return a.split(';')[0] - b.split(';')[0]});

									var finalResult = "";
									for(i = 0; i < resultSet.length; i++){
										finalResult += "<tr>";
										var resultSet_i = resultSet[i].split(";");
										for(j = 0; j < resultSet_i.length-2; j++){
											finalResult += "<td>";
											finalResult += resultSet_i[j];
											finalResult += "</td>";
										}
										finalResult += "</tr>";
									}
									document.getElementById("source").innerHTML += finalResult;
								}
					  }
					};
					xmlhttp.open("GET","./txt/" + type + "Html.txt",true);
					xmlhttp.send();
			}

			var modal2 = document.getElementById('myModal2');
			var close2 = document.getElementById("close2");
			// When the user clicks on the button, open the modal
			function btnOpenModal2(str1, str2) {
			    modal2.style.display = "block";
					document.getElementById("source2").innerHTML = '<tr>'
					+ '<th>例句</th>'
					+ '</tr>'
					+ '<tr>'
					+ '<td>' + str1 + '</td>'
					+ '</tr>';
					document.getElementById("source3").innerHTML = '<tr>'
					+ '<th>解釋</th>'
					+ '</tr>'
					+ '<tr>'
					+ '<td>' + str2 + '</td>'
					+ '</tr>';
			}
			// When the user clicks on <span> (x), close the modal
			close2.onclick = function() {
			    modal2.style.display = "none";
			}
			// When the user clicks anywhere outside of the modal, close it

			function closeSourcePage(event){
			    if(event.target == modal2) {
						modal2.style.display = "none";
					}
			}

			window.onclick = function(event) {
			    closeSourcePage(event);
			}

			window.addEventListener('touchstart', function (event) {
			    closeSourcePage(event);
			});
	</script>

	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
