<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link id="stylecall4" rel="stylesheet" href="/css/japanese.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

</head>

<title>Dadiu | 大家的日本語 - 詞典</title>

<body onload="">
	<div id="head">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">首頁</a>
	</div>

	<!--TODO-->
	<style>
	.search {
	  width: 100%;
	  position: relative;
	  display: flex;
	}

	.searchTerm {
	  width: 100%;
	  border: 3px solid #c9c9c9;
	  border-right: none;
	  padding: 5px;
	  height: 20px;
	  border-radius: 5px 0 0 5px;
	  outline: none;
	  color: #616161;
	  font-size: 14px;
	}

	.searchTerm:focus{
	  color: #4d4d4d;
	}

	.searchButton {
	  width: 40px;
	  height: 36px;
	  border: 1px solid #c9c9c9;
	  background: #c9c9c9;
	  text-align: center;
	  color: #fff;
	  border-radius: 0 5px 5px 0;
	  cursor: pointer;
	  font-size: 20px;
		margin-top: 5px;
		margin-bottom: 5px;
	}

	/*Resize the wrap to see the search bar change!*/
	.wrap{
	  width: 100%;
	}

	input[type="text"]{
		width: 100%;
	}
	</style>
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">


	<div class="wrap">
		<div class="search">
				<input type="text" class="searchTerm" id="searchKey" name="search"/>
				<button type="submit" class="searchButton" onclick="searchAll()"><i class="fa fa-search"></i></button>
		</div>
	</div>

	<div class="w3-light-grey">
	  <div id="myBar" class="w3-container w3-green" style="display:none; height:24px; background-color: #cfcfcf; color: #999999; font-weight: bold;"></div>
	</div>

	<div id="myModal" class="modal">
	  <div class="modal-content">
			<a id="toppest" class="smooth"></a>
			<table id="source">
			</table>
	  </div>
	</div>

	<script>

			var existSearchKey = "";
			var responseTotal = 0;

			function searchAll(){
				var searchKey = document.getElementById("searchKey").value.trim();
				if(searchKey != existSearchKey){
						document.getElementById("source").innerHTML = '<tr>'
									+	'<th>日語</th>'
									+ '<th>重音</th>'
									+ '<th>漢字</th>'
									+ '<th>解釋</th>'
									//+ '<th>英語</th>'
									+ '<th>詞性</th>'
									+ '<th>單元</th>'
									+ '</tr>';

						if(searchKey != ""){
							document.getElementById("myBar").style.display = "block";
							existSearchKey = searchKey;
							for(i = 1; i <= 50; i++){
								searchEach('Old' + i, searchKey);
							}
						}
				}
			}

			function searchEach(type, searchKey)
			{
					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
					  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
								var dir = [];
					    	var txt = xmlhttp.responseText;

								var arr = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							  var arrJp = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
							  var arrJpS = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrZh = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								var arrEn = txt.split('<span class="txt-ja txt-ls1 kana" style="display:none;">');
								arr.shift();
								arrJp.shift();
								arrJpS.shift();
								arrZh.shift();
								arrEn.shift();

								for(i = 0; i < arr.length; i++){
									arrJp[i] = arr[i].substr(0, arrJp[i].indexOf('</span>')).trim();
									dir[i] = '<tr>';
									dir[i] += '<td>' + arrJp[i] + '</td>';

									var accentText = arr[i].split('<span class="txt-ja toneNum">');
									var accentValue = '';
									if(accentText.length == 2){
										accentValue = accentText[1].substr(0, accentText[1].indexOf('</span> </span>'))
										.trim()
										.replace('</span> <span>','][')
										.replace('<span>','')
										.replace('⓪','0')
										.replace('①','1')
										.replace('②','2')
										.replace('③','3')
										.replace('④','4')
										.replace('⑤','5')
										.replace('⑥','6')
										.replace('⑦','7')
										.replace('⑧','8')
										.replace('⑨','9')
										.replace('⑩','10');
									}
									dir[i] += '<td>';
									if(accentValue != ''){
										dir[i] += '[' + accentValue + ']';
										arrJp[i] += '<span class="accentJpValue">[' + accentValue + ']</span>';
									}
									dir[i] += '</td>';

									var jpText = arr[i].split('<span class="txt-ja txt-ls1 kanji">');
									var jpValue = '';
									if(jpText.length == 2){
										jpValue = jpText[1].substr(0, jpText[1].indexOf('</span>'))
										.trim()
										.replace(/・/g, ' / ')
										.replace('【', '')
										.replace('】', '');
									}
									arrJpS[i] = jpValue;
									dir[i] += '<td>' + jpValue + '</td>';

									var zhText = arr[i].split('<p class="txt-zh zh">');
									var zhValue = '';
									if(zhText.length == 2){
										zhValue = zhText[1].substr(0, zhText[1].indexOf('</p>'))
										.replace(/・/g, ' / ');
									}else{
										zhValue = '';
									}
									arrZh[i] = zhValue;
									dir[i] += '<td>' + zhValue + '</td>';

									/*
									var enText = arr[i].split('<p class="txt-zh en">');
									var enValue = '';
									if(enText.length == 2){
										enValue = enText[1].substr(0, enText[1].indexOf('</p>'))
										.replace('(英) ','')
										.replace(/・/g, ' / ');
									}
									dir[i] += '<td>' + enValue + '</td>';
									*/

									var typeText = arr[i].split('<span class="wordClass" style="">');
									var typeValue = '';
									if(typeText.length == 2){
										typeValue = typeText[1].substr(0, typeText[1].indexOf('</span>'))
										.trim()
										.replace(/・/g, ' / ')
										.replace('《', '')
										.replace('》', '');
									}
									dir[i] += '<td>' + typeValue + '</td>';
									dir[i] += '<td>' + type.replace("Old", ""); + '</td>';

									dir[i] += '</tr>';

									if(arrZh[i].includes("<")){
										arrZh[i] = arrZh[i].split("<")[0];
									}
									if(arrJp[i].includes("<")){
										arrJp[i] = arrJp[i].split("<")[0];
									}
									if(arrJpS[i].includes("<")){
										arrJpS[i] = arrJpS[i].split("<")[0];
									}
									if(arrZh[i].includes(searchKey) || arrJp[i].includes(searchKey) || arrJpS[i].includes(searchKey)){
										document.getElementById("source").innerHTML += dir[i];
									}
								}
								responseTotal++;
								if(responseTotal == 50){
									document.getElementById("myBar").style.display = "none";
									elem.style.width = '0%';
									document.getElementById("myBar").innerHTML = '0%';
									responseTotal = 0;
								}else{
									var elem = document.getElementById("myBar");
									elem.style.width = (responseTotal * 2) + '%';
									document.getElementById("myBar").innerHTML = (responseTotal * 2)  + '%';
								}
					  }
					};
					xmlhttp.open("GET","./txt/" + type + "Html.txt",true);
					xmlhttp.send();
			}
	</script>

	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
