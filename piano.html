<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.scrollTo.js"></script>
		<script type="text/javascript" src="/js/audiosynth.js"></script>

</head>

<title>Dadiu | Piano</title>

<body onload="init()">
	<div id="head">
		<div id="logo">
			<a href="/"><img src="/img/dadiu.png" alt="dai01" class="logo_dadiu"></a>
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">Home</a>
	</div>

	<!--TODO-->
	<div id="buttonBox">
	  <button id="btnClick" class="buttonJp btnFilter" onclick="loadSrc('testing')">Click Me</button>
	</div>


  <input id="fileInput" type="file" name="file" />
  <pre  style="display:none" id="fileContent"></pre>

	<script>
	function init(){
	  document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);
	}

	function handleFileSelect(event){
	  const reader = new FileReader()
	  reader.onload = handleFileLoad;
	  reader.readAsText(event.target.files[0])
	}

	function handleFileLoad(event){
	  console.log(event);
	  document.getElementById('fileContent').textContent = event.target.result;
		loadText(event.target.result);
	}

	function loadSrc(type){
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function(){
					if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
							var string = [];
							var txt = xmlhttp.responseText;
							loadText(txt);
					}
				};
				xmlhttp.open("GET","./music/txt/" + type + ".txt",true);
				xmlhttp.send();
	}

	function loadText(text){
			var noteArr = text.split(',');
			for(i = 0; i < noteArr.length; i++){
					var tempArr = noteArr[i].split('_');
					if(tempArr.length == 4){
							temp_2 = tempArr[2];
							if(tempArr[2].includes("/")){
								var divideArr = tempArr[2].split("/");
								if(divideArr.length == 2){
									temp_2 = divideArr[0] / divideArr[1];
								}
							}
							playOneNote(tempArr[0].trim(), tempArr[1], temp_2, tempArr[3]);
					}
			}
	}

	function playOneNote(note, interval, duration, startTime){
			setTimeout(function() {
						var piano = Synth.createInstrument('piano');
						piano.play(note, interval, duration); // plays C4 for 2s using the 'piano' sound profile
			}, startTime);
	}
	</script>

	<ul id="foot">
		</br>
		<li>Â© Copyright 2020. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
