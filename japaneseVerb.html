<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link id="stylecall4" rel="stylesheet" href="/css/japanese.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

</head>

<title>Dadiu | 動詞的活用形 - 測驗</title>

<body onload="restart();">
	<div id="head">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">首頁</a>
	</div>

	<!--TODO-->
		<!-- The Modal -->
		<link rel="stylesheet" href="/css/modal_box_style.css">
		<div id="myModal" class="modal">
		  <div class="modal-content">
		    <span id="close" class="close">&times;</span>
				<a id="toppest" class="smooth"></a>
				<table id="source">
				</table>
		  </div>
		</div>

		<div id="buttonBox">
			<button id="btnOpenModal" class="buttonJp btnFilter">內容</button>
			<button id="btnFilterShow" class="buttonJp btnFilter active" onclick="openNav()">過濾</button>
			<button id="btnTraslateWay" class="buttonJp btnFilter" onclick="changeWayUI()">日語 => 中文</button>
		</div>

		<p class="showText" style="font-size:8vw;" id="textJapan"></p>
		<input type="text" id="inputKey"/>
		<p><button id="submit" class="buttonJp next" type="button" onclick="showResult()" style="width:49%;">確定</button>
			<button id="next" class="buttonJp next" type="button" onclick="restart()" style="width:49%;">下一個</button></p>
		<h4 style="text-align: center;" id="result"></h4>

		<link rel="stylesheet" href="/css/side_bar_style.css">
		<div id="nav_subtitle">
			<div id="mySidenav" class="sidenav">
					<a id="toppestNav" class="smooth"></a>
					<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
			 		<a href="#" id="btnFilterte" onclick="filterSelection('te')">て形</a>
			 		<a href="#" id="btnFilterjisho" onclick="filterSelection('jisho')">辭書形</a>
			 		<a href="#" id="btnFilternai" onclick="filterSelection('nai')">ない形</a>
			 		<a href="#" id="btnFilterta" onclick="filterSelection('ta')">た形</a>
			 		<a href="#" id="btnFilteriko" onclick="filterSelection('iko')">意向形</a>
			 		<a href="#" id="btnFiltermeirei" onclick="filterSelection('meirei')">命令形</a>
			 		<a href="#" id="btnFilterjoken" onclick="filterSelection('joken')">條件形</a>
			 		<a href="#" id="btnFilterkano" onclick="filterSelection('kano')">可能形</a>
			 		<a href="#" id="btnFilterukemisonkei" onclick="filterSelection('ukemisonkei')">被動 、尊敬形</a>
			 		<a href="#" id="btnFiltershieki" onclick="filterSelection('shieki')">使役形</a>
			</div>
		</div>

		<link rel="stylesheet" type="text/css" href="/css/to_top_not_immediate.css">
		<div id="head">
			<div id="nav">
				 <ul>
					 	<li><a id="myBtn" href="#toppest" class="subtitle" >置頂</a></li>
						<li><a id="myBtnNav" href="#toppestNav" class="subtitle" >置頂</a></li>
				 </ul>
			</div>
		</div>

		<script>
		var total = 0;
		var filterSelected = "te";
		var changeWay = 0;
		var arrPos = {};
		var arrNeg = {};
		var index = parseInt(Math.random() * (total - 1) + 1, 10);
		var showText = "";
		var correct = 0;
		var ttlAns = 0;
		var answered = true;

		var myModal = document.getElementById('myModal');
		myModal.onscroll = function() {scrollFunction(myModal, "myBtn")};
		var mySidenav = document.getElementById('mySidenav');
		mySidenav.onscroll = function() {scrollFunction(mySidenav, "myBtnNav")};

		function openNav() {
				var btnFilterShow = document.getElementById("btnFilterShow");
				if(btnFilterShow.className.includes("active")){
					closeNav();
				}else{
					scrollFunction(mySidenav, "myBtnNav");
					mySidenav.style.width = "300px";
					document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
					btnFilterShow.className += " active";
				}
		}
		function closeNav() {
				document.getElementById("mySidenav").style.width = "0px";
				document.body.style.backgroundColor = "#fbf7ff";
				document.getElementById("myBtnNav").style.display = "none";

				var btnFilterShow = document.getElementById("btnFilterShow");
				btnFilterShow.className = btnFilterShow.className.replace(" active", "");
		}

		function scrollFunction(body, id) {
			if (body.scrollTop > 100) {
				document.getElementById(id).style.display = "block";
			} else {
				document.getElementById(id).style.display = "none";
			}
		}

			//open source start
			var modal = document.getElementById('myModal');
			var btnOpenModal = document.getElementById("btnOpenModal");
			var close = document.getElementById("close");
			// When the user clicks on the button, open the modal
			btnOpenModal.onclick = function() {
			    modal.style.display = "block";
					btnOpenModal.className += " active";
					scrollFunction(modal, "myBtn")
			}
			// When the user clicks on <span> (x), close the modal
			close.onclick = function() {
			    modal.style.display = "none";
					btnOpenModal.className = btnOpenModal.className.replace(" active", "");
			}
			// When the user clicks anywhere outside of the modal, close it

			function closeSourcePage(event){
			    if (event.target == modal) {
			        modal.style.display = "none";
							btnOpenModal.className = btnOpenModal.className.replace(" active", "");
							document.getElementById("myBtn").style.display = "none";
			    }else if(event.target != document.getElementById("btnFilterShow")
							&& event.target != document.getElementById("btnFilterte")
							&& event.target != document.getElementById("btnFilterjisho")
							&& event.target != document.getElementById("btnFilternai")
							&& event.target != document.getElementById("btnFilterta")
							&& event.target != document.getElementById("btnFilteriko")
							&& event.target != document.getElementById("btnFiltermeirei")
							&& event.target != document.getElementById("btnFilterjoken")
							&& event.target != document.getElementById("btnFilterkano")
							&& event.target != document.getElementById("btnFilterukemisonkei")
							&& event.target != document.getElementById("btnFiltershieki")
							&& event.target != document.getElementById("mySidenav")
							&& event.target != document.getElementById("myBtnNav")
							&& document.getElementById("mySidenav").style.width != "0px"
						){
							closeNav();
					}
			}

			window.onclick = function(event) {
			    closeSourcePage(event);
			}

			window.addEventListener('touchstart', function (event) {
			    closeSourcePage(event);
			});
			//open source end

			function changeWayUI(){
				var btn = document.getElementById("btnTraslateWay");
				if(changeWay == 0){
					changeWay = 1;
					btn.className += " active";
					btn.innerHTML = "中文 => 日語";
				}else{
					changeWay = 0
					btn.className = btn.className.replace(" active", "");
					btn.innerHTML = "日語 => 中文";
				}
				restart();
			}

			function loadDoc(type)
			{
					arrPos = {};
					arrNeg = {};
					document.getElementById("source").innerHTML = '<tr>'
										+	'<th>'
										+ ("jisho" == type ? "辭書形" : "ます形 、辭書形")
										+ '</th>'
										+ '<th>' + document.getElementById("btnFilter" + type).innerHTML + '</th>'
										+ '</tr>';

					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
					  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
					    	var txt = xmlhttp.responseText;
								var dir = "";
								var arr = txt.split(']="');
								arr.shift();

								for(i = 0; i < arr.length; i++){
									if(i % 2 == 0){
										arrPos[i / 2] = arr[i].substr(0, arr[i].indexOf('";')).trim();
										dir += '<tr><td>' + arrPos[i / 2] + '</td>';
									}else{
										arrNeg[(i - 1) / 2] = arr[i].substr(0, arr[i].indexOf('";')).trim();
										dir += '<td>' + arrNeg[(i - 1) / 2] + '</td></tr>';
									}
								}
								document.getElementById("source").innerHTML += dir;

								if(changeWay){
										var arrTemp = {};
										for(i = 0; i < (arr.length / 2); i++){
											arrTemp[i] = arrPos[i];
										}
										for(i = 0; i < (arr.length / 2); i++){
											arrPos[i] = arrNeg[i];
										}
										for(i = 0; i < (arr.length / 2); i++){
											arrNeg[i] = arrTemp[i];
										}
								}
								total = arr.length / 2;
								console.log(arrPos);
								console.log(arrNeg);
								genShowJpText();
					  }
					};
					xmlhttp.open("GET","./verb/" + type + "01.txt",true);
					xmlhttp.send();
			}

			function filterSelection(text){
				var element = document.getElementById("btnFilter" + text);
				filterSelected = text;
				loadDoc(text);
				closeNav();
				document.getElementById("btnFilterShow").innerHTML = element.innerHTML + " [過濾]";
				document.getElementById("btnOpenModal").innerHTML = element.innerHTML + " [內容]";
				clear();
			}

			function genShowJpText(){
				index = parseInt(Math.random() * (total - 0) + 0, 10);
				showText = arrPos[index];
				document.getElementById("textJapan").innerHTML = showText;
			}

			function showResult(){
				if(!answered){	//brendan
					if(document.getElementById("inputKey").value != arrNeg[index]){
						document.getElementById("inputKey").style.borderColor  = "#FF0000";
					}else{
						correct++;
					}
					document.getElementById("inputKey").style.borderColor  = "#4CAF50";
					answered = true;
					ttlAns++;
					document.getElementById("result").innerHTML  = correct + " / " + ttlAns;
				}
			}

			function restart(){
				filterSelection(filterSelected);
				clear();
			}

			function clear(){
				answered = false;
			}
		</script>
		<script type="text/javascript" src="/js/jquery.scrollTopMyModel.js"></script>
		<script type="text/javascript" src="/js/jquery.scrollTopMySidenav.js"></script>

	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
