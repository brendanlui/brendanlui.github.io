<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
	<link id="stylecall1" rel="stylesheet" href="/css/academic_style.css" />
	<link id="stylecall2" rel="stylesheet" href="/css/logo_dadiu.css" />
	<link id="stylecall3" rel="stylesheet" href="/css/inputButton.css" />
	<link id="stylecall4" rel="stylesheet" href="/css/japanese.css" />
	<link rel="icon"
	  type="image/png"
	  href="/img/d01.png">
	  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.scrollTo.js"></script>

</head>

<title>Dadiu | 動詞的活用形 - 測驗</title>

<body onload="restart();">
	<div id="head">
		<div id="logo">
			<img src="/img/dadiu.png" alt="dai01" class="logo_dadiu">
		</div>
	</div>

	<link rel="stylesheet" href="/css/responsive_bar_style.css">
	<div class="topnav" id="myTopnav">
	  <a href="/">首頁</a>
	</div>

	<!--TODO-->
		<!-- The Modal -->
		<link rel="stylesheet" href="/css/modal_box_style.css">
		<div id="myModal" class="modal">
		  <div class="modal-content">
		    <span id="close" class="close">&times;</span>
				<a id="toppest" class="smooth"></a>
				<table id="source">
				</table>
		  </div>
		</div>

		<div id="buttonBox">
			<button id="btnOpenModal" class="buttonJp btnFilter">內容</button>
			<button id="btnFilterShow" class="buttonJp btnFilter active" onclick="openNav()">過濾</button>
			<button id="btnTraslateWay" class="buttonJp btnFilter" onclick="changeWayUI()">ます形 => て形</button>
		</div>

		<p class="showText" style="font-size:6vw;" id="textJapan"></p>
		<input type="text" style="font-size:6vw; padding: 0px 0px; width: 99%; text-align: center;" id="inputKey"/>
		<p><button id="submit" class="buttonJp next" type="button" onclick="showResult()" style="width:49%;">確定</button>
			<button id="next" class="buttonJp next" type="button" onclick="restart()" style="width:49%;">下一個</button></p>
		<h4 style="text-align: center;" id="result"></h4>

		<link rel="stylesheet" href="/css/side_bar_style.css">
		<div id="nav_subtitle">
			<div id="mySidenav" class="sidenav">
					<a id="toppestNav" class="smooth"></a>
					<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
			 		<a href="#" id="btnFilterte01" onclick="filterSelection('te01')">て形 (ます形) I</a>
			 		<a href="#" id="btnFilterte02" onclick="filterSelection('te02')">て形 (ます形) II</a>
			 		<a href="#" id="btnFilterte03" onclick="filterSelection('te03')">て形 (ます形) III</a>
			 		<a href="#" id="btnFilterte04" onclick="filterSelection('te04')">て形 (辭書形) I</a>
			 		<a href="#" id="btnFilterte055" onclick="filterSelection('te05')">て形 (辭書形) II</a>
			 		<a href="#" id="btnFilterte06" onclick="filterSelection('te06')">て形 (辭書形) III</a>
			 		<a href="#" id="btnFilterjisho01" onclick="filterSelection('jisho01')">辭書形 (ます形) I</a>
			 		<a href="#" id="btnFilterjisho02" onclick="filterSelection('jisho02')">辭書形 (ます形) II</a>
			 		<a href="#" id="btnFilterjisho03" onclick="filterSelection('jisho03')">辭書形 (ます形) III</a>
			 		<a href="#" id="btnFilternai01" onclick="filterSelection('nai01')">ない形 (ます形) I</a>
					<a href="#" id="btnFilternai02" onclick="filterSelection('nai02')">ない形 (ます形) II</a>
					<a href="#" id="btnFilternai03" onclick="filterSelection('nai03')">ない形 (ます形) III</a>
			 		<a href="#" id="btnFilternai04" onclick="filterSelection('nai04')">ない形 (辭書形) I</a>
			 		<a href="#" id="btnFilternai05" onclick="filterSelection('nai05')">ない形 (辭書形) II</a>
			 		<a href="#" id="btnFilternai06" onclick="filterSelection('nai06')">ない形 (辭書形) III</a>
			 		<a href="#" id="btnFilterta01" onclick="filterSelection('ta01')">た形 (ます形) I</a>
					<a href="#" id="btnFilterta02" onclick="filterSelection('ta02')">た形 (ます形) II</a>
					<a href="#" id="btnFilterta03" onclick="filterSelection('ta03')">た形 (ます形) III</a>
					<a href="#" id="btnFilterta04" onclick="filterSelection('ta04')">た形 (辭書形) I</a>
					<a href="#" id="btnFilterta05" onclick="filterSelection('ta05')">た形 (辭書形) II</a>
					<a href="#" id="btnFilterta06" onclick="filterSelection('ta06')">た形 (辭書形) III</a>
			 		<a href="#" id="btnFilteriko01" onclick="filterSelection('iko01')">意向形 (ます形) I</a>
			 		<a href="#" id="btnFilteriko02" onclick="filterSelection('iko02')">意向形 (ます形) II</a>
			 		<a href="#" id="btnFilteriko03" onclick="filterSelection('iko03')">意向形 (辭書形) I</a>
			 		<a href="#" id="btnFilteriko04" onclick="filterSelection('iko04')">意向形 (辭書形) II</a>
			 		<a href="#" id="btnFiltermeirei01" onclick="filterSelection('meirei01')">命令形 (ます形) I</a>
			 		<a href="#" id="btnFiltermeirei02" onclick="filterSelection('meirei02')">命令形 (ます形) II</a>
			 		<a href="#" id="btnFiltermeirei03" onclick="filterSelection('meirei03')">命令形 (辭書形) I</a>
			 		<a href="#" id="btnFiltermeirei04" onclick="filterSelection('meirei04')">命令形 (辭書形) II</a>
			 		<a href="#" id="btnFilterjoken01" onclick="filterSelection('joken01')">條件形 (ます形) I</a>
			 		<a href="#" id="btnFilterjoken02" onclick="filterSelection('joken02')">條件形 (ます形) II</a>
			 		<a href="#" id="btnFilterjoken03" onclick="filterSelection('joken03')">條件形 (ます形) III</a>
			 		<a href="#" id="btnFilterjoken04" onclick="filterSelection('joken04')">條件形 (辭書形) I</a>
			 		<a href="#" id="btnFilterjoken05" onclick="filterSelection('joken05')">條件形 (辭書形) II</a>
			 		<a href="#" id="btnFilterjoken06" onclick="filterSelection('joken06')">條件形 (辭書形) III</a>
			 		<a href="#" id="btnFilterkano01" onclick="filterSelection('kano01')">可能形 (ます形) I</a>
			 		<a href="#" id="btnFilterkano02" onclick="filterSelection('kano02')">可能形 (ます形) II</a>
			 		<a href="#" id="btnFilterkano03" onclick="filterSelection('kano03')">可能形 (ます形) III</a>
			 		<a href="#" id="btnFilterkano04" onclick="filterSelection('kano04')">可能形 (辭書形) I</a>
			 		<a href="#" id="btnFilterkano05" onclick="filterSelection('kano05')">可能形 (辭書形) II</a>
			 		<a href="#" id="btnFilterkano06" onclick="filterSelection('kano06')">可能形 (辭書形) III</a>
			 		<a href="#" id="btnFilterukemisonkei01" onclick="filterSelection('ukemisonkei01')">被動、尊敬形 (ます形) I</a>
			 		<a href="#" id="btnFilterukemisonkei02" onclick="filterSelection('ukemisonkei02')">被動、尊敬形 (ます形) II</a>
			 		<a href="#" id="btnFilterukemisonkei03" onclick="filterSelection('ukemisonkei03')">被動、尊敬形 (ます形) III</a>
			 		<a href="#" id="btnFilterukemisonkei04" onclick="filterSelection('ukemisonkei04')">被動、尊敬形 (辭書形) I</a>
			 		<a href="#" id="btnFilterukemisonkei05" onclick="filterSelection('ukemisonkei05')">被動、尊敬形 (辭書形) II</a>
			 		<a href="#" id="btnFilterukemisonkei06" onclick="filterSelection('ukemisonkei06')">被動、尊敬形 (辭書形) III</a>
			 		<a href="#" id="btnFiltershieki01" onclick="filterSelection('shieki01')">使役形 (ます形) I</a>
			 		<a href="#" id="btnFiltershieki02" onclick="filterSelection('shieki02')">使役形 (ます形) II</a>
			 		<a href="#" id="btnFiltershieki03" onclick="filterSelection('shieki03')">使役形 (ます形) III</a>
			 		<a href="#" id="btnFiltershieki04" onclick="filterSelection('shieki04')">使役形 (辭書形) I</a>
			 		<a href="#" id="btnFiltershieki05" onclick="filterSelection('shieki05')">使役形 (辭書形) II</a>
			 		<a href="#" id="btnFiltershieki06" onclick="filterSelection('shieki06')">使役形 (辭書形) III</a>
					</br></br></br></br></br></br>
			</div>
		</div>

		<link rel="stylesheet" type="text/css" href="/css/to_top_not_immediate.css">
		<div id="head">
			<div id="nav">
				 <ul>
					 	<li><a id="myBtn" href="#toppest" class="subtitle" >置頂</a></li>
						<li><a id="myBtnNav" href="#toppestNav" class="subtitle" >置頂</a></li>
				 </ul>
			</div>
		</div>

		<script>
		var total = 0;
		var filterSelected = "te01";
		var changeWay = 0;
		var arrPos = {};
		var arrNeg = {};
		var index = parseInt(Math.random() * (total - 1) + 1, 10);
		var showText = "";
		var correct = 0;
		var ttlAns = 0;
		var answered = 0;

		var myModal = document.getElementById('myModal');
		myModal.onscroll = function() {scrollFunction(myModal, "myBtn")};
		var mySidenav = document.getElementById('mySidenav');
		mySidenav.onscroll = function() {scrollFunction(mySidenav, "myBtnNav")};

		function openNav() {
				var btnFilterShow = document.getElementById("btnFilterShow");
				if(btnFilterShow.className.includes("active")){
					closeNav();
				}else{
					scrollFunction(mySidenav, "myBtnNav");
					mySidenav.style.width = "300px";
					document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
					btnFilterShow.className += " active";
				}
		}
		function closeNav() {
				document.getElementById("mySidenav").style.width = "0px";
				document.body.style.backgroundColor = "#fbf7ff";
				document.getElementById("myBtnNav").style.display = "none";

				var btnFilterShow = document.getElementById("btnFilterShow");
				btnFilterShow.className = btnFilterShow.className.replace(" active", "");
		}

		function scrollFunction(body, id) {
			if (body.scrollTop > 100) {
				document.getElementById(id).style.display = "block";
			} else {
				document.getElementById(id).style.display = "none";
			}
		}

			//open source start
			var modal = document.getElementById('myModal');
			var btnOpenModal = document.getElementById("btnOpenModal");
			var close = document.getElementById("close");
			// When the user clicks on the button, open the modal
			btnOpenModal.onclick = function() {
			    modal.style.display = "block";
					btnOpenModal.className += " active";
					scrollFunction(modal, "myBtn")
			}
			// When the user clicks on <span> (x), close the modal
			close.onclick = function() {
			    modal.style.display = "none";
					btnOpenModal.className = btnOpenModal.className.replace(" active", "");
			}
			// When the user clicks anywhere outside of the modal, close it

			function closeSourcePage(event){
			    if (event.target == modal) {
			        modal.style.display = "none";
							btnOpenModal.className = btnOpenModal.className.replace(" active", "");
							document.getElementById("myBtn").style.display = "none";
			    }else if(event.target != document.getElementById("btnFilterShow")
							&& event.target != document.getElementById("btnFilterte01")
							&& event.target != document.getElementById("btnFilterte02")
							&& event.target != document.getElementById("btnFilterte03")
							&& event.target != document.getElementById("btnFilterte04")
							&& event.target != document.getElementById("btnFilterte05")
							&& event.target != document.getElementById("btnFilterte06")
							&& event.target != document.getElementById("btnFilterjisho01")
							&& event.target != document.getElementById("btnFilterjisho02")
							&& event.target != document.getElementById("btnFilterjisho03")
							&& event.target != document.getElementById("btnFilternai01")
							&& event.target != document.getElementById("btnFilternai02")
							&& event.target != document.getElementById("btnFilternai03")
							&& event.target != document.getElementById("btnFilternai04")
							&& event.target != document.getElementById("btnFilternai05")
							&& event.target != document.getElementById("btnFilternai06")
							&& event.target != document.getElementById("btnFilterta01")
							&& event.target != document.getElementById("btnFilterta02")
							&& event.target != document.getElementById("btnFilterta03")
							&& event.target != document.getElementById("btnFilterta04")
							&& event.target != document.getElementById("btnFilterta05")
							&& event.target != document.getElementById("btnFilterta06")
							&& event.target != document.getElementById("btnFilteriko01")
							&& event.target != document.getElementById("btnFilteriko02")
							&& event.target != document.getElementById("btnFilteriko03")
							&& event.target != document.getElementById("btnFilteriko04")
							&& event.target != document.getElementById("btnFiltermeirei01")
							&& event.target != document.getElementById("btnFiltermeirei02")
							&& event.target != document.getElementById("btnFiltermeirei03")
							&& event.target != document.getElementById("btnFiltermeirei04")
							&& event.target != document.getElementById("btnFilterjoken01")
							&& event.target != document.getElementById("btnFilterjoken02")
							&& event.target != document.getElementById("btnFilterjoken03")
							&& event.target != document.getElementById("btnFilterjoken04")
							&& event.target != document.getElementById("btnFilterjoken05")
							&& event.target != document.getElementById("btnFilterjoken06")
							&& event.target != document.getElementById("btnFilterkano01")
							&& event.target != document.getElementById("btnFilterkano02")
							&& event.target != document.getElementById("btnFilterkano03")
							&& event.target != document.getElementById("btnFilterkano04")
							&& event.target != document.getElementById("btnFilterkano05")
							&& event.target != document.getElementById("btnFilterkano06")
							&& event.target != document.getElementById("btnFilterukemisonkei01")
							&& event.target != document.getElementById("btnFilterukemisonkei02")
							&& event.target != document.getElementById("btnFilterukemisonkei03")
							&& event.target != document.getElementById("btnFilterukemisonkei04")
							&& event.target != document.getElementById("btnFilterukemisonkei05")
							&& event.target != document.getElementById("btnFilterukemisonkei06")
							&& event.target != document.getElementById("btnFiltershieki01")
							&& event.target != document.getElementById("btnFiltershieki02")
							&& event.target != document.getElementById("btnFiltershieki03")
							&& event.target != document.getElementById("btnFiltershieki04")
							&& event.target != document.getElementById("btnFiltershieki05")
							&& event.target != document.getElementById("btnFiltershieki06")
							&& event.target != document.getElementById("mySidenav")
							&& event.target != document.getElementById("myBtnNav")
							&& document.getElementById("mySidenav").style.width != "0px"
						){
							closeNav();
					}
			}

			window.onclick = function(event) {
			    closeSourcePage(event);
			}

			window.addEventListener('touchstart', function (event) {
			    closeSourcePage(event);
			});
			//open source end

			function changeWayUI(){
				var btn = document.getElementById("btnTraslateWay");
				if(changeWay == 0){
					changeWay = 1;
					btn.className += " active";
				}else{
					changeWay = 0
					btn.className = btn.className.replace(" active", "");
				}
				restart();
			}

			function loadDoc(type)
			{
					arrPos = {};
					arrNeg = {};
					name = document.getElementById("btnFilter" + type).innerHTML;
					pos = name.split(" (")[1].split(") ")[0];
					neg = name.split(" (")[0];
					document.getElementById("source").innerHTML = '<tr>'
										+	'<th>'
										+ pos
										+ '</th>'
										+ '<th>'
										+ neg
										+ '</th>'
										+ '</tr>';

					if(changeWay == 1){
						document.getElementById("btnTraslateWay").innerHTML = neg + " => " + pos;
					}else{
						document.getElementById("btnTraslateWay").innerHTML = pos + " => " + neg;
					}

					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
					  if(xmlhttp.status == 200 && xmlhttp.readyState == 4){
					    	var txt = xmlhttp.responseText;
								var dir = "";
								txt = '1]="かわります（変わります）";s[1]="かわっかかて";';//debug
								var arr = txt.split(']="');
								arr.shift();

								for(i = 0; i < arr.length; i++){
									if(i % 2 == 0){
										arrPos[i / 2] = arr[i].substr(0, arr[i].indexOf('";')).trim();
										dir += '<tr><td>' + arrPos[i / 2] + '</td>';
									}else{
										arrNeg[(i - 1) / 2] = arr[i].substr(0, arr[i].indexOf('";')).trim();
										dir += '<td>' + arrNeg[(i - 1) / 2] + '</td></tr>';
									}
								}
								document.getElementById("source").innerHTML += dir;

								if(changeWay){
										var arrTemp = {};
										for(i = 0; i < (arr.length / 2); i++){
											arrTemp[i] = arrPos[i];
										}
										for(i = 0; i < (arr.length / 2); i++){
											arrPos[i] = arrNeg[i];
										}
										for(i = 0; i < (arr.length / 2); i++){
											arrNeg[i] = arrTemp[i];
										}
								}
								total = arr.length / 2;
								genShowJpText();
					  }
					};
					xmlhttp.open("GET","./verb/" + type + ".txt",true);
					xmlhttp.send();
			}

			function filterSelection(text){
				var element = document.getElementById("btnFilter" + text);
				filterSelected = text;
				loadDoc(text);
				closeNav();
				document.getElementById("btnFilterShow").innerHTML = element.innerHTML + " [過濾]";
				document.getElementById("btnOpenModal").innerHTML = element.innerHTML + " [內容]";
				clear();
			}

			function genShowJpText(){
				index = parseInt(Math.random() * (total - 0) + 0, 10);
				showText = arrPos[index];
				document.getElementById("textJapan").innerHTML = showText;
			}

			function showResult(){
				if(answered == 0){

						var ques_1 = "";
						var ques_2 = "";
						var sameString = "";
						var firstAns;
						var secondAns;

						if(arrPos[index].includes("（") && changeWay == 0){
							ques_1 = arrPos[index].split("（")[0];
							ques_2 = arrPos[index].split("（")[1].replace("）", "");
							sameString = findLongestWithEndCommonSubstring(ques_1, ques_2);
							firstAns = arrNeg[index];
							secondAns = firstAns.replace(ques_1.replace(sameString, ""), ques_2.replace(sameString, ""));
						}else if(arrNeg[index].includes("（") && changeWay == 1){
							firstAns = arrNeg[index].split("（")[0];
							secondAns = arrNeg[index].split("（")[1].replace("）", "");
						}

						if(document.getElementById("inputKey").value != firstAns
							&& document.getElementById("inputKey").value != secondAns){
							document.getElementById("inputKey").style.borderColor  = "#FF0000";
							document.getElementById("textJapan").innerHTML += "</br> => </br><span style='color:red;'>" + arrNeg[index] + "</span>";
						}else{
							correct++;
							document.getElementById("inputKey").style.borderColor  = "#4CAF50";
						}
						ttlAns++;
						document.getElementById("result").innerHTML  = correct + " / " + ttlAns;
						answered = 1;
						document.getElementById("inputKey").disabled = true;
						document.getElementById("submit").disabled = true;
						document.getElementById("submit").style.backgroundColor = "#bfbfbf";
				}
			}

			function restart(){
				filterSelection(filterSelected);
				clear();
			}

			function clear(){
				document.getElementById("inputKey").style.borderColor  = "#ffffff";
				document.getElementById("inputKey").disabled = false;
				document.getElementById("submit").disabled = false;
				document.getElementById("submit").style.backgroundColor = "#555555";
				document.getElementById("inputKey").value = "";
				answered = 0;
			}

			//copy from web start
			var findLongestWithEndCommonSubstring = function(a,b) {
			  var longest = "";
			  // loop through the first string
			  for (var i = 0; i < a.length; ++i) {
			    // loop through the second string
			    for (var j = 0; j < b.length; ++j) {
			      // if it's the same letter
			      if (a[i] === b[j]) {
			        var str = a[i];
			        var k = 1;
			        // keep going until the letters no longer match, or we reach end
			        while (i+k < a.length && j+k < b.length // haven't reached end
			               && a[i+k] === b[j+k]) { // same letter
			          str += a[i+k];
			          ++k;
			        }
			        // if this substring is longer than the longest, save it as the longest
			        if (str.length > longest.length
								&& a.endsWith(str) && b.endsWith(str)
							) { longest = str }
			      }
			    }
			  }
			  return longest;
			};
			//copy from web end
		</script>
		<script type="text/javascript" src="/js/jquery.scrollTopMyModel.js"></script>
		<script type="text/javascript" src="/js/jquery.scrollTopMySidenav.js"></script>

	<ul id="foot">
		</br>
		<li>© Copyright 2019. All Rights Reserved.</li>
	</ul></br>
</body>
</html>
